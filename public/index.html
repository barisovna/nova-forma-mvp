<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#f59e0b" />
    <link rel="icon" type="image/png" href="/assets/limon/limonfoto1.png" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="stylesheet" href="/styles.css" />
    <title>Web Alchemy Fit Quest</title>
  </head>
  <body>
    <main class="container">
      <header class="hero" id="step-hero">
        <div>
          <p class="hero-tag">Web Alchemy Fit Quest</p>
          <h1>Похудение как игра с живым AI-агентом</h1>
          <p class="hero-sub">
            Лимон-агент ведет по шагам, реагирует на прогресс и поддерживает серию без пропусков.
          </p>
        </div>
        <div class="hero-status">
          <span class="badge" id="healthBadge">API: проверка...</span>
          <span class="badge" id="providerBadge">LLM: ...</span>
          <span class="badge" id="activeUserBadge">Профиль не создан</span>
        </div>
      </header>

      <section class="card game-card" id="step-game">
        <h2>Игровой центр</h2>
        <div class="stats-grid">
          <article class="stat">
            <p class="stat-label">Уровень</p>
            <p class="stat-value" id="statLevel">1</p>
          </article>
          <article class="stat">
            <p class="stat-label">Серия дней</p>
            <p class="stat-value" id="statStreak">0</p>
          </article>
          <article class="stat">
            <p class="stat-label">Очки</p>
            <p class="stat-value" id="statPoints">0</p>
          </article>
          <article class="stat">
            <p class="stat-label">Достижения</p>
            <p class="stat-value" id="statAchievements">0</p>
          </article>
        </div>
        <div class="xp-wrap">
          <div class="xp-label">
            <span>Опыт до следующего уровня</span>
            <span id="xpText">0 / 50 XP</span>
          </div>
          <div class="xp-track">
            <div class="xp-fill" id="xpFill"></div>
          </div>
        </div>
        <h3 class="quest-title">Ежедневные квесты</h3>
        <ul class="quest-list" id="questList"></ul>
      </section>

      <section class="card step-card" id="step-onboard">
        <div class="step-head">
          <span class="step-index">Шаг 1</span>
          <h2>Онбординг</h2>
        </div>
        <form id="onboardForm" class="form-grid">
          <label>
            Имя
            <input type="text" id="name" required placeholder="Например, Anna" />
          </label>
          <label>
            Цель
            <input type="text" id="goal" placeholder="похудеть / поддерживать / набор" />
          </label>
          <label>
            Целевые ккал
            <input type="number" id="caloriesTarget" min="800" max="5000" value="1900" />
          </label>
          <button type="submit">Создать профиль</button>
        </form>
      </section>

      <section class="card step-card" id="step-plan">
        <div class="step-head">
          <span class="step-index">Шаг 2</span>
          <h2>План питания</h2>
        </div>
        <form id="planForm" class="form-grid">
          <label>
            Предпочтения
            <textarea
              id="preferences"
              rows="3"
              placeholder="Например: без лактозы, больше белка, меньше сладкого"
            ></textarea>
          </label>
          <button type="submit">Сгенерировать план</button>
        </form>
        <details class="debug-box" data-dev-only>
          <summary>Показать сырой ответ плана</summary>
          <pre id="planOutput" class="output"></pre>
        </details>
      </section>

      <section class="card step-card" id="step-meal">
        <div class="step-head">
          <span class="step-index">Шаг 3</span>
          <h2>Лог питания</h2>
        </div>
        <form id="mealForm" class="form-grid">
          <label>
            Блюдо
            <input type="text" id="mealName" required placeholder="Оладушки, омлет, салат..." />
          </label>
          <label>
            Ккал
            <input type="number" id="mealCalories" min="0" max="5000" value="450" />
          </label>
          <label>
            Дата (для теста серии)
            <input type="date" id="mealDate" />
          </label>
          <button type="submit">Добавить лог</button>
        </form>
      </section>

      <section class="card step-card" id="step-subscription">
        <div class="step-head">
          <span class="step-index">Шаг 4</span>
          <h2>Подписка</h2>
        </div>
        <form id="subscriptionForm" class="form-grid">
          <label>
            Тариф
            <select id="subscriptionTier">
              <option value="free">free</option>
              <option value="trial" selected>trial</option>
              <option value="premium">premium</option>
            </select>
          </label>
          <button type="submit">Сохранить тариф</button>
        </form>
      </section>

      <section class="card step-card" id="step-progress">
        <div class="step-head">
          <span class="step-index">Шаг 5</span>
          <h2>Прогресс</h2>
        </div>
        <div class="button-row">
          <button id="refreshProgress" type="button">Обновить прогресс</button>
          <button id="refreshEvents" type="button" class="ghost-button">Обновить события</button>
        </div>
        <details class="debug-box" data-dev-only>
          <summary>Показать сырой ответ прогресса</summary>
          <pre id="progressOutput" class="output"></pre>
        </details>
        <details class="debug-box" data-dev-only>
          <summary>Показать журнал событий</summary>
          <pre id="eventsOutput" class="output"></pre>
        </details>
      </section>
    </main>

    <div class="agent-layer" aria-live="polite">
      <div id="agentBubble" class="agent-bubble">Я живой лимон. Начнем с профиля.</div>
      <div class="lemon-agent" id="lemonAgent">
        <span class="agent-glow"></span>
        <img id="lemonImage" src="/assets/limon/limonfoto1.png" alt="Лимон AI агент" loading="lazy" />
        <video id="lemonVideo" class="lemon-video-hidden" muted playsinline preload="metadata"></video>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
